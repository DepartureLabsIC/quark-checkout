{"version":3,"file":"quark-checkout.validate.esm.js","sources":["../../../src/schemas.ts","../index.ts"],"sourcesContent":["import { z } from \"zod\"\nimport { Principal as P } from \"@dfinity/principal\"\n\nconst validatePrincipal = (p: string) => {\n  try {\n    return p === P.fromText(p).toText()\n  } catch (e) {\n    return false\n  }\n}\n\nconst DESCRIPTION = {\n  PROVIDER:\n    \"This can be either a wallet or an identity provider. The user will only be able to connect with this provider on Quark's Checkout page\",\n  INTEGRATOR:\n    \"The Quark Address of the integrator. This address will receive the payment upon a successful checkout\",\n  NOTIFY: {\n    PRINCIPAL_ID:\n      \"The Principal ID of the canister that receives the callback from Quark to notify the payment result\",\n    METHOD:\n      \"The name of the canister method that is called from Quark to notify the payment result\",\n  },\n  BAKSET: {\n    NAME: \"The name of the basket item.\",\n    DESCRIPTION: \"Optional description of the basket item.\",\n  },\n}\n\nconst II = z.literal(\"ii\", { description: \"Internet Identity\" })\nexport const PROVIDERS = { II: II.value }\n\nconst printProviders = () => Object.values(PROVIDERS).join(\", \")\nconst Provider = z.string().refine(s => s === II.value, {\n  message: `Invalid provider. Expected Provider as String. Choose between: ${printProviders()}`,\n})\n\nconst Integrator = z\n  .string({\n    description: DESCRIPTION.INTEGRATOR,\n    invalid_type_error:\n      \"Invalid integrator. Expected Quark address (username@testnet.quark) as String\",\n    required_error: \"Config.integrator is required\",\n  })\n  .email({\n    message: \"Invalid value for Config.integrator\",\n  })\n\nconst Domain = z\n  .string({\n    description: \"The domain of the Quark website\",\n    required_error: \"Config.domain is required\",\n  })\n  .url({ message: \"Invalid url\" })\n  .regex(/(^http:\\/\\/localhost:\\d+$)|(^(https:\\/\\/).*(.ic0.app)$)/i, {\n    message: \"Invalid domain\",\n  })\n\n// .args() is `MessageEvent.data`\n// See: https://developer.mozilla.org/en-US/docs/Web/API/MessageEvent/data\nconst Callback = z.function().args(z.any()).returns(z.any())\n\n/**\n * Notify\n *\n * Used to produce a Candid func that is called when the checkout\n * has been confirmed on the Quark website. From there on out it is\n * up to the integrator to process all the bought items by the end-user.\n *\n * More info:\n * https://smartcontracts.org/docs/candid-guide/candid-types.html#type-func\n */\n\nconst Principal = z\n  .string({\n    description: DESCRIPTION.NOTIFY.PRINCIPAL_ID,\n    required_error: \"Config.notify.principalId is required\",\n  })\n  .refine(p => validatePrincipal(p), {\n    message: \"Invalid Principal ID\",\n  })\n\nconst MethodName = z.string({\n  description: DESCRIPTION.NOTIFY.METHOD,\n  required_error: \"Config.notify.method is required\",\n})\nconst Notify = z\n  .object({\n    principalId: Principal,\n    methodName: MethodName,\n  })\n  .required()\n  .strict()\n\n/**\n * Config\n *\n * A config to initialize Quark on the integrator's website.\n */\nexport const Config = z\n  .object({\n    provider: Provider,\n    integrator: Integrator,\n    domain: Domain,\n    callback: Callback,\n    notify: Notify,\n  })\n  .required()\n  .strict()\n\nexport type Config = z.infer<typeof Config>\n\n/**\n * Tokens\n */\nconst TEST = z.literal(\"TEST\", {\n  description: \"Quark Test Token. Used for development on testnets\",\n})\nexport const TOKENS = { II: II.value }\n\n/**\n * BasketItem\n */\n\nconst Name = z\n  .string({\n    description: DESCRIPTION.BAKSET.NAME,\n    required_error: \"Basket.name is required\",\n  })\n  .min(1, { message: \"Basket.name must be at least 1 character long\" })\n  .max(100, { message: \"Basket.name must be at most 100 characters long\" })\nconst Description = z\n  .string({\n    description: DESCRIPTION.BAKSET.DESCRIPTION,\n  })\n  .min(1, { message: \"Basket.description must be at least 1 character long\" })\n  .max(100, {\n    message: \"Basket.description must be at most 100 characters long\",\n  })\nconst Value = z\n  .number({\n    description: \"Number of tokens to pay for this Basket item.\",\n    invalid_type_error: \"Invalid Basket.value Type. Expected Number\",\n    required_error: \"Basket.value is required\",\n  })\n  .positive({ message: \"Basket.value must be greater than 0\" })\n\nconst printTokens = () => Object.values(TOKENS).join(\", \")\nconst Token = z.string().refine(s => s === TEST.value, {\n  message: `Invalid provider. Expected Provider as String. Choose between: ${printTokens()}`,\n})\n\n/**\n * Basket\n *\n * The basket is an array of items that the end-user has selected to pay for.\n * The name, description and price of each item is shown on the Quark website\n * upon Checkout.\n */\n\nconst BasketItem = z\n  .object({\n    name: Name,\n    description: Description.optional(),\n    value: Value,\n    token: Token,\n  })\n  .required()\nexport const Basket = BasketItem.array()\nexport type Basket = z.infer<typeof Basket>\n\n/**\n * Checkout\n */\n\nconst Checkout = z.function().args(Basket).returns(z.boolean())\nexport type Checkout = z.infer<typeof Checkout>\n\n/**\n * Because the `basket` and `window` can only be assigned by the user's browser, we need to\n * use a closure to create a Checkout function with all necessary values to send to the Quark window.\n */\n\nconst Closure = z.object({\n  window: z.any(),\n  basket: Basket.optional(),\n})\nexport type Closure = {\n  window?: Window\n  basket?: Basket\n}\n\n/**\n * CreateCheckout\n *\n * Used to produce a Function that can be implemented by the integrator how they see fit.\n * The user will most likely call this function when the user clicks a \"Pay\" button.\n */\n\nconst CreateCheckoutConfig = z\n  .object({\n    provider: Provider,\n    domain: Domain,\n    closure: Closure,\n  })\n  .required()\n  .strict()\nexport type CreateCheckoutConfig = z.infer<typeof CreateCheckoutConfig>\n\nconst CreateCheckout = z.function().args(CreateCheckoutConfig).returns(Checkout)\nexport type CreateCheckout = z.infer<typeof CreateCheckout>\n","/**\n * validate - Validate quark config and basket\n *\n * Please delete package when validated.\n *\n * This package helps you use correctly setup your quark integration.\n * By calling this function you can validate your Quark config and\n * basket data during runtime.\n */\nimport { Config, Basket } from \"../../src/schemas\"\n\nfunction config(c: Config) {\n  return Config.parse(c)\n}\n\nfunction basket(b: Basket) {\n  return Basket.parse(b)\n}\n\nconst validate = { config, basket }\nexport { validate }\n"],"names":["P"],"mappings":"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"}